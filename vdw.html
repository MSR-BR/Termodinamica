<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Equação de Van der Waals — p(v) reduzido + espinodal</title>
  <style>
    :root { --bg:#0b0d10; --fg:#e6eef8; --muted:#9fb3c8; --grid:#243140; --accent:#4da3ff; --spinodal:#ff7a59; }
    * { box-sizing:border-box; }
    body { margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color:var(--fg); background:var(--bg); }
    header { padding:14px 16px; border-bottom:1px solid #15202b; background:#0f1318; position:sticky; top:0; z-index:10; }
    h1 { font-size:20px; margin:0 0 4px; }
    .sub { color:var(--muted); font-size:13px; }
    main { display:grid; grid-template-columns:1fr; gap:14px; padding:14px; max-width:1000px; margin:0 auto; }
    .panel { background:#0f141a; border:1px solid #1d2a36; border-radius:16px; padding:14px; box-shadow:0 4px 20px rgba(0,0,0,.35); }
    .controls { display:grid; gap:10px; align-items:center; grid-template-columns: 90px 1fr 90px; font-size:14px; }
    input[type="range"] { width:100%; }
    .badge { display:inline-block; padding:.1rem .45rem; border-radius:999px; font-size:12px; background:#16212d; color:var(--muted); border:1px solid #223142; }
    .legend { display:flex; gap:10px; flex-wrap:wrap; align-items:center; font-size:13px; color:var(--muted); }
    .key { display:inline-flex; align-items:center; gap:6px; }
    .swatch { width:16px; height:3px; border-radius:2px; display:inline-block; }
    .swatch.curva { background:var(--accent); }
    .swatch.spin { background:var(--spinodal); box-shadow:0 0 0 1px var(--spinodal); }
    .swatch.crit { width:8px; height:8px; border-radius:50%; background:#ffd166; }
    #chartWrap { position:relative; width:100%; aspect-ratio: 16/10; }
    svg { width:100%; height:100%; display:block; }
    .axis text { fill:var(--muted); font-size:12px; }
    .axis .tick line { stroke:var(--grid); }
    .axis path, .axis .domain { stroke:var(--muted); opacity:.35; }
    .grid line { stroke:var(--grid); }
    .curve { fill:none; stroke:var(--accent); stroke-width:2.0; }
    .spinodal { fill:none; stroke:var(--spinodal); stroke-width:1.8; stroke-dasharray:6 6; }
    .critical { fill:#ffd166; stroke:#000; stroke-width:.8; }
    footer { color:var(--muted); font-size:12px; padding:0 14px 14px; max-width:1000px; margin:0 auto; }
    a { color:#8dc1ff; }
  </style>
</head>
<body>
  <header>
    <h1>Equação de Van der Waals — <span class="badge">p × v (variáveis reduzidas)</span></h1>
    <div class="sub">Ajuste a temperatura reduzida <b>t</b> e observe a isoterma <i>p(v)</i> dada por (p + 3/v²)(v − 1/3) = 8t/3. A curva tracejada é a espinodal p = (3v − 2)/v³; o ponto crítico é (v, p, t) = (1, 1, 1).</div>
    <div class="sub" style="margin-top:6px">Definições reduzidas: v = V/Vc, t = T/Tc, p = P/Pc, com Vc = 3nb, Tc = 8a/(27bR), Pc = a/(27b²).</div>
    <div class="sub" style="margin-top:10px">Desenvolvido por <b>Mario Reis</b> — Instituto de Física, Universidade Federal Fluminense (UFF) · <a href="mailto:marioreis@id.uff.br">marioreis@id.uff.br</a> · <a href="https://profmarioreis.wordpress.com" target="_blank">profmarioreis.wordpress.com</a> · 22 de setembro de 2025</div>
  </header>

  <main>
    <section class="panel">
      <div class="controls" role="group" aria-label="Controles de temperatura">
        <label for="t">Temperatura t</label>
        <input id="t" type="range" min="0.85" max="1.4" step="0.01" value="0.90" aria-valuemin="0.85" aria-valuemax="1.4" aria-valuenow="0.90" />
        <div id="tVal" class="badge">t = 0.90</div>
      </div>
    </section>

    <section id="chart" class="panel">
      <div id="chartWrap">
        <svg id="svg" viewBox="0 0 800 520" aria-labelledby="title desc" role="img">
          <title id="title">Diagrama p × v do gás de Van der Waals</title>
          <desc id="desc">Curva p(v) para uma temperatura reduzida t ajustável e a curva espinodal em p = (3v − 2)/v³; inclui grelha e eixos com marcas.</desc>
          <!-- Camadas -->
          <g id="grid" class="grid"></g>
          <g id="axes" class="axis"></g>
          <path id="spin" class="spinodal" />
          <path id="curve" class="curve" />
          <circle id="cp" class="critical" r="4" />
        </svg>
      </div>
      <div class="legend" style="margin-top:10px">
        <span class="key"><span class="swatch curva"></span> isoterma p(v) para t</span>
        <span class="key"><span class="swatch spin"></span> espinodal</span>
        <span class="key"><span class="swatch crit"></span> ponto crítico</span>
      </div>
    </section>
  </main>

  <script>
    function linScale(domainMin, domainMax, rangeMin, rangeMax) {
      const d = domainMax - domainMin, r = rangeMax - rangeMin;
      return {
        x(v){ return rangeMin + ( (v - domainMin) / d ) * r; },
        inv(px){ return domainMin + ((px - rangeMin)/r) * d; }
      };
    }

    const svg = document.getElementById('svg');
    const gGrid = document.getElementById('grid');
    const gAxes = document.getElementById('axes');
    const pathCurve = document.getElementById('curve');
    const pathSpin = document.getElementById('spin');
    const cp = document.getElementById('cp');

    const W = 800, H = 520, m = {l:70, r:20, t:20, b:60};
    const inner = {x:m.l, y:m.t, w:W - m.l - m.r, h:H - m.t - m.b};

    let vMin = 0.35, vMax = 4.8;
    let pMin = -0.3, pMax = 3.5; // escala ajustada

    const sx = linScale(vMin, vMax, inner.x, inner.x + inner.w);
    const sy = linScale(pMax, pMin, inner.y, inner.y + inner.h);

    function drawAxes() {
      gAxes.innerHTML = '';
      gGrid.innerHTML = '';
      const gx = 0.5;
      const gy = 0.5;

      for (let v = Math.ceil(vMin/gx)*gx; v <= vMax+1e-9; v += gx) {
        const X = sx.x(v);
        const gline = document.createElementNS('http://www.w3.org/2000/svg','line');
        gline.setAttribute('x1', X); gline.setAttribute('x2', X);
        gline.setAttribute('y1', inner.y); gline.setAttribute('y2', inner.y+inner.h);
        gGrid.appendChild(gline);

        const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
        tick.setAttribute('x1', X); tick.setAttribute('x2', X);
        tick.setAttribute('y1', inner.y+inner.h); tick.setAttribute('y2', inner.y+inner.h+6);
        tick.setAttribute('stroke','currentColor'); tick.classList.add('tick');
        gAxes.appendChild(tick);

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', X); label.setAttribute('y', inner.y+inner.h+20);
        label.setAttribute('text-anchor','middle'); label.textContent = v.toFixed(1);
        gAxes.appendChild(label);
      }

      for (let p = Math.ceil(pMin/gy)*gy; p <= pMax+1e-9; p += gy) {
        const Y = sy.x(p);
        const gline = document.createElementNS('http://www.w3.org/2000/svg','line');
        gline.setAttribute('x1', inner.x); gline.setAttribute('x2', inner.x+inner.w);
        gline.setAttribute('y1', Y); gline.setAttribute('y2', Y);
        gGrid.appendChild(gline);

        const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
        tick.setAttribute('x1', inner.x-6); tick.setAttribute('x2', inner.x);
        tick.setAttribute('y1', Y); tick.setAttribute('y2', Y);
        tick.setAttribute('stroke','currentColor'); tick.classList.add('tick');
        gAxes.appendChild(tick);

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', inner.x-10); label.setAttribute('y', Y+4);
        label.setAttribute('text-anchor','end'); label.textContent = p.toFixed(1);
        gAxes.appendChild(label);
      }

      const xAxis = document.createElementNS('http://www.w3.org/2000/svg','path');
      xAxis.setAttribute('d', `M ${inner.x} ${inner.y+inner.h} H ${inner.x+inner.w}`);
      xAxis.setAttribute('class','domain');
      gAxes.appendChild(xAxis);

      const yAxis = document.createElementNS('http://www.w3.org/2000/svg','path');
      yAxis.setAttribute('d', `M ${inner.x} ${inner.y} V ${inner.y+inner.h}`);
      yAxis.setAttribute('class','domain');
      gAxes.appendChild(yAxis);

      const xLabel = document.createElementNS('http://www.w3.org/2000/svg','text');
      xLabel.setAttribute('x', inner.x + inner.w/2);
      xLabel.setAttribute('y', H-20);
      xLabel.setAttribute('text-anchor','middle');
      xLabel.textContent = 'volume reduzido v';
      gAxes.appendChild(xLabel);

      const yLabel = document.createElementNS('http://www.w3.org/2000/svg','text');
      yLabel.setAttribute('x', 18);
      yLabel.setAttribute('y', inner.y + inner.h/2);
      yLabel.setAttribute('transform', `rotate(-90 18 ${inner.y + inner.h/2})`);
      yLabel.setAttribute('text-anchor','middle');
      yLabel.textContent = 'pressão reduzida p';
      gAxes.appendChild(yLabel);
    }

    function pOfVT(v, t){
      return (8*t/3)/(v - 1/3) - 3/(v*v);
    }

    function pSpin(v){
      return (3*v - 2)/(v*v*v);
    }

    function pathFrom(points){
      return points.map((p,i)=> (i? 'L':'M') + ' ' + p[0].toFixed(2) + ' ' + p[1].toFixed(2)).join(' ');
    }

    function computeCurve(t){
      const pts = [];
      const eps = 1e-3;
      for(let v = vMin; v < 1/3 - eps; v += 0.003){
        const p = pOfVT(v, t); if (isFinite(p)) pts.push([sx.x(v), sy.x(p)]);
      }
      const pts2 = [];
      for(let v = 1/3 + eps; v <= vMax; v += 0.003){
        const p = pOfVT(v, t); if (isFinite(p)) pts2.push([sx.x(v), sy.x(p)]);
      }
      return {left: pts, right: pts2};
    }

    function computeSpinodal(){
      const pts = [];
      for(let v = vMin; v <= vMax; v += 0.003){
        const p = pSpin(v); if (isFinite(p)) pts.push([sx.x(v), sy.x(p)]);
      }
      return pts;
    }

    function update(t){
      document.getElementById('tVal').textContent = `t = ${Number(t).toFixed(2)}`;
      document.getElementById('t').setAttribute('aria-valuenow', String(t));

      const curve = computeCurve(t);
      const dLeft = pathFrom(curve.left);
      const dRight = pathFrom(curve.right);
      pathCurve.setAttribute('d', dLeft + ' ' + dRight);

      const dSpin = pathFrom(computeSpinodal());
      pathSpin.setAttribute('d', dSpin);

      cp.setAttribute('cx', sx.x(1));
      cp.setAttribute('cy', sy.x(1));
    }

    drawAxes();
    update(0.90);

    document.getElementById('t').addEventListener('input', (e)=> update(e.target.value));
  </script>
</body>
</html>
